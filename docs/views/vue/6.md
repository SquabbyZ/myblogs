---
title: Vue 全局 API
date: 2020-04-07
tags:
  - Vue
categories:
  - Vue
---

## Vue.directive 自定义指令

1. `vuecli` 全局自定义指令，我把下面这段代码写在了 `main.js` 中，这样就可以全局使用这个指令


```javascript
Vue.directive('changecolor', function (el, binding, vnode) {
  console.log(el);
  console.log(binding);
  console.log(vnode);
  el.style = "color:" + binding.value;
})

```

1. 局部组件自定义命令，在组件内部和 methods、data、computed 等同级，按照下面的模板写就可以自定义指令,只有该组件内才能使用该自定义指令，如果在别的组件使用该命令都不会生效，并且 vue 会报如下警告 <span style="color:red">`[Vue warn]: Failed to resolve directive: changecolor (found in <Btn> at src/components/Btn.vue)`</span>

```javascript
 directives: {
    changecolor: {
      inserted: function(el, binding, vnode) {
        console.log(el);
        console.log(binding);
        console.log(vnode);
        el.style = "color:" + binding.value;
      }
    }
  }

```

再来阐述下  el、binding、vnode 分别代表什么
|  名称   |                  阐述                   |                                          控制台打印示例                                           |
| :-----: | :-------------------------------------: | :-----------------------------------------------------------------------------------------------: |
|   el    | 指令所绑定的元素，可以用来直接操作DOM。 |                       `<button class="btn" style="color:red;">...</button>`                       |
| binding |     一个对象，包含指令的很多信息。      | `{name:"changecolor",rawName:"v-changecolor",value:"red",expression:"`red`",modifiers:{...},...}` |
|  vnode  |         Vue编译生成的虚拟节点。         |     `Vnode {tag:"button",data:{...},children:Array(1),text:undefinded,elm:button.btnbtn,...`}     |


#### 自定义指令的生命周期

自定义指令有五个生命周期（也叫钩子函数），分别是 bind,inserted,update,componentUpdated,unbind

<ul>

<li>1. bind:只调用一次，指令第一次绑定到元素时调用，用这个钩子函数可以定义一个绑定时执行一次的初始化动作。</li>
<li>2. inserted:被绑定元素插入父节点时调用（父节点存在即可调用，不必存在于document中）。</li>
<li>3. update:被绑定于元素所在的模板更新时调用，而无论绑定值是否变化。通过比较更新前后的绑定值，可以忽略不必要的模板更新。</li>
<li>4. componentUpdated:被绑定元素所在模板完成一次更新周期时调用。</li>
<li>5. unbind:只调用一次，指令与元素解绑时调用。</li>
</ul>

```javascript

bind:function(){//被绑定
     console.log('1 - bind');
},
inserted:function(){//绑定到节点
      console.log('2 - inserted');
},
update:function(){//组件更新
      console.log('3 - update');
},
componentUpdated:function(){//组件更新完成
      console.log('4 - componentUpdated');
},
unbind:function(){//解绑
      console.log('1 - bind');
}
```

## Vue.extend 构造器

::: tip 什么是 Vue.extend

Vue.extend 返回的是一个“扩展实例构造器”,也就是预设了部分选项的Vue实例构造器。经常服务于Vue.component用来生成组件，可以简单理解为当在模板中遇到该组件名称作为标签的自定义元素时，会自动调用“扩展实例构造器”来生产组件实例，并挂载到自定义元素上。
:::

### 自定义无参数标签

::: tip 设计需求
在博客页面多处显示作者的网名，并在网名上直接有链接地址。我们希望在html中只需要写没有传递任何参数的静态`<author></author>`标签

:::

代码如下:

```javascript

let authorExtend = Vue.extend({
    template:"<p><a :href='authorUrl'>{{authorName}}</a></p>",
    data:function(){
    return{
          authorName:'zhuhaifeng',
          authorUrl:'http://39.106.197.44'
          }
    }
});
```

但是这时候的 html 标签不起作用，因为扩展实例构造器是需要挂载的，再加入下面的语句

```javascript
new authorExtend().$mount('author')

```

#### 挂载到普通标签上

以通过HTML标签上的id或者class来生成扩展实例构造器，Vue.extend里的代码是一样的，只是在挂载的时候，我们用类似jquery的选择器的方法，来进行挂载就可以了。

```javascript
new authorExtend().$mount('#author');
```


## Vue.set 全局操作

Vue.set 的作用就是在构造器外部操作构造器内部的数据、属性或者方法。比如在vue构造器内部定义了一个count为1的数据，我们在构造器外部定义了一个方法，要每次点击按钮给值加1.就需要用到Vue.set。

### 一、引用构造器外部数据:

什么是外部数据，就是不在Vue构造器里的data处声明，而是在构造器外部声明，然后在data处引用就可以了。外部数据的加入让程序更加灵活，我们可以在外部获取任何想要的数据形式，然后让data引用。 看一个简单的代码：

```javascript

//在构造器外部声明数据
 var outData={
    count:1,
    goodName:'car'
};
var app=new Vue({
    el:'#app',
    //引用外部数据
    data:outData
})
```

### 二、在外部改变数据的三种方法

1. 用 Vue.set 改变

```javascript
function add(){
       Vue.set(outData,'count',4);
 }
```

1. 用 Vue 对象的方法添加

```javascript
app.count++;
```

1. 直接操作外部数据

```javascript
outData.count++;
```

其实这三种方式都可以操作外部的数据，Vue也给我们增加了一种操作外部数据的方法。

::: tip 为什么要有 Vue.set 的存在
由于 JavaScript 的限制，Vue 不能自动检测以下变动的数组。

      1. 当你利用索引直接设置一个项时，vue 不会为我们自动更新
      2. 当你修改数组长度时，vue 不会为我们自动更新

:::

示例demo

```html
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <script type="text/javascript" src="../assets/js/vue.js"></script>
    <title>Vue.set 全局操作</title>
</head>
<body>
    <h1>Vue.set 全局操作</h1>
    <hr>
    <div id="app">
        <ul>
            <li v-for=" aa in arr">{{aa}}</li>
        </ul>

    </div>
    <button onclick="add()">外部添加</button>

    <script type="text/javascript">

        function add(){
            console.log("我已经执行了");
           app.arr[1]='ddd';
           //Vue.set(app.arr,1,'ddd');
        }
        var outData={
            arr:['aaa','bbb','ccc']
        };
        var app=new Vue({
            el:'#app',
            data:outData
        })
    </script>
</body>
</html>
```

这时我们的界面是不会自动跟新数组的，我们需要用Vue.set(app.arr,1,’ddd’)来设置改变，vue才会给我们自动更新，这就是Vue.set存在的意义。

## Vue 的生命周期函数(钩子函数)

Vue一共有10个生命周期函数，我们可以利用这些函数在vue的每个阶段都进行操作数据或者改变内容。
<!-- ![](http://lc-zltjehaI.cn-n1.lcfile.com/c8a516580b1d11589bc7/vue6-2.jpg) -->
<!-- ![](http://lc-zltjehaI.cn-n1.lcfile.com/3d4d4c8ba97f521d3fd0/vue6-1.jpg) -->