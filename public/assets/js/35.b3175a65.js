(window.webpackJsonp=window.webpackJsonp||[]).push([[35],{544:function(e,s,t){"use strict";t.r(s);var v=t(3),r=Object(v.a)({},(function(){var e=this,s=e.$createElement,t=e._self._c||s;return t("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[t("div",{staticClass:"custom-block tip"},[t("p",{staticClass:"custom-block-title"},[e._v("eCryptfs 简介")]),e._v(" "),t("p",[e._v("eCryptfs 是在 Linux kernel 实现的一个加密文件系统，在 Linux kernel 2.6.19 版本收纳入官方 Linux kernel。它采用堆叠式的设计思想，逻辑上位于 VFS 和传统文件系统之间。用户应用程序对传统文件系统的读写操作，经过系统调用通过 VFS 首先被 eCryptfs 截获，eCryptfs 对文件数据进行加解密的操作，再转发给传统文件系统，为应用提供透明、动态、高效的加密功能。")]),e._v(" "),t("p",[e._v("eCryptfs 对每个文件采用不同的文件加密密钥 ( File Encryption Key, FEK )，文件加密算法推荐使用 AES-128。FEK 不能以明文的形式存放，eCryptfs 使用用户提供的口令（Passphrase）、非对称密钥算法（如 RSA 算法）或 TPM（Trusted Platform Module）的公钥来加密保护 FEK。")]),e._v(" "),t("p",[e._v("例如，当使用用户口令的时候，口令先经 hash 函数处理，再做为密钥加密 FEK。口令/公钥称为文件加密密钥加密密钥（File Encryption Key Encryption Key，FEFEK），加密后的 FEK 则称为加密文件密钥（Encrypted File Encryption Key，EFEK )。如果一个文件被多个授权用户访问，则有多份 EFEK。 此外，eCryptfs 还支持文件名的加密。")])]),e._v(" "),t("h2",{attrs:{id:"ubuntu上-ecryptfs-安装方法"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#ubuntu上-ecryptfs-安装方法"}},[e._v("#")]),e._v(" Ubuntu上 eCryptfs 安装方法")]),e._v(" "),t("ol",[t("li",[e._v("查看 "),t("code",[e._v("eCryptfs")]),e._v(" 用户态的工具是否安装：")])]),e._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[e._v("dpkg --status ecryptfs-utils\n")])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br")])]),t("p",[e._v("返回 "),t("code",[e._v("dpkg-query: package 'ecryptfs-utils' is not installed and no information is available")]),e._v(",就是未安装。")]),e._v(" "),t("ol",{attrs:{start:"2"}},[t("li",[e._v("安装命令")])]),e._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[e._v("sudo")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[e._v("apt-get")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[e._v("install")]),e._v(" ecryptfs-utils\n")])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br")])]),t("p",[e._v("执行完之后，再执行第一步操作，不返回第一步提示的结果，证明安装成功。")]),e._v(" "),t("h2",{attrs:{id:"ecryptfs-的使用"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#ecryptfs-的使用"}},[e._v("#")]),e._v(" eCryptfs 的使用")]),e._v(" "),t("ol",[t("li",[e._v("创建登录密码和挂载密码 "),t("code",[e._v("ecryptfs-setup-private")]),e._v("会提示\n"),t("ol",[t("li",[t("code",[e._v("Enter your login passphrase [root]")]),e._v(",输入服务器的 "),t("code",[e._v("root")]),e._v(" 密码")]),e._v(" "),t("li",[t("code",[e._v("Enter your mount passphrase [leave blank to generate one]")]),e._v(" 输入挂载密码")]),e._v(" "),t("li",[t("code",[e._v("输入两次挂载口令")]),e._v(" 再次输入挂载密码")])])]),e._v(" "),t("li",[e._v("我们先创建个测试文件夹 "),t("code",[e._v("Private")]),e._v(",修改文件夹权限，使其他人无法访问这个文件夹,再用ecrypt挂载文件夹（加密）")])]),e._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[e._v("mkdir")]),e._v(" -p /root/Private\n"),t("span",{pre:!0,attrs:{class:"token function"}},[e._v("chmod")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[e._v("700")]),e._v(" /root/Private\n"),t("span",{pre:!0,attrs:{class:"token function"}},[e._v("mount")]),e._v(" -t ecryptfs /root/Private /root/Private\n")])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br"),t("span",{staticClass:"line-number"},[e._v("2")]),t("br"),t("span",{staticClass:"line-number"},[e._v("3")]),t("br")])]),t("ol",{attrs:{start:"3"}},[t("li",[t("p",[e._v("会显示如下内容:")]),e._v(" "),t("ol",[t("li",[t("code",[e._v("Passphrase:")]),e._v(" ,首先需要输入挂载密码（不同于登录密码），为了方便记忆我们就先输入文件夹的名称 "),t("code",[e._v("Private")]),e._v(" (不能为空否则会警告 "),t("code",[e._v("Wrong input, non-empty value required!")]),e._v(")")]),e._v(" "),t("li",[e._v("然后需要选择密钥计算方式（直接回车为默认）,这里我选择了默认 "),t("code",[e._v("aes")]),e._v(" 方式"),t("br"),e._v(" "),t("code",[e._v("Select cipher:")]),t("br"),e._v(" "),t("code",[e._v("1) aes: blocksize = 16; min keysize = 16; max keysize = 32")]),t("br"),e._v(" "),t("code",[e._v("2) blowfish: blocksize = 8; min keysize = 16; max keysize = 56")]),t("br"),e._v(" "),t("code",[e._v("3) des3_ede: blocksize = 8; min keysize = 24; max keysize = 24")]),t("br"),e._v(" "),t("code",[e._v("4) twofish: blocksize = 16; min keysize = 16; max keysize = 32")]),t("br"),e._v(" "),t("code",[e._v("5) cast6: blocksize = 16; min keysize = 16; max keysize = 32")]),t("br"),e._v(" "),t("code",[e._v("6) cast5: blocksize = 8; min keysize = 5; max keysize = 16")]),t("br"),e._v(" "),t("code",[e._v("Selection [aes]:")]),t("br")]),e._v(" "),t("li",[e._v("显示如下:(这里就是选择了对应的加密方式只会，现在密钥的长度)"),t("br"),e._v(" "),t("code",[e._v("Select key bytes:")]),e._v(" "),t("br"),e._v(" "),t("code",[e._v("1) 16")]),e._v(" "),t("br"),e._v(" "),t("code",[e._v("2) 32")]),e._v(" "),t("br"),e._v(" "),t("code",[e._v("3) 24")]),e._v(" "),t("br"),e._v(" "),t("code",[e._v("Selection [16]:")]),e._v(" 默认选择的是 16 位 "),t("br")]),e._v(" "),t("li",[e._v("然后会显示是否启用明文传递 (默认选择是 no，不启用)，我这里选择了 y "),t("br"),e._v(" "),t("code",[e._v("Enable plaintext passthrough (y/n) [n]:")])]),e._v(" "),t("li",[e._v("然后会提示是否将文件名称加密(默认选择是 no)，我这里也选择 no "),t("br"),e._v(" "),t("code",[e._v("Enable filename encryption (y/n) [n]")])]),e._v(" "),t("li",[e._v("会显示你之前选择配置的那些信息,然后询问你想继续安装么？ 我选择 yes "),t("br"),e._v(" "),t("code",[e._v("Attempting to mount with the following options:")]),e._v(" "),t("br"),e._v(" "),t("code",[e._v("ecryptfs_unlink_sigs")]),e._v(" "),t("br"),e._v(" "),t("code",[e._v("ecryptfs_passthrough")]),e._v(" "),t("br"),e._v(" "),t("code",[e._v("ecryptfs_key_bytes=16")]),e._v(" "),t("br"),e._v(" "),t("code",[e._v("ecryptfs_cipher=aes")]),e._v(" "),t("br"),e._v(" "),t("code",[e._v("ecryptfs_sig=181fb852cfe09961")]),e._v(" "),t("br"),e._v(" "),t("code",[e._v("WARNING: Based on the contents of [/root/.ecryptfs/sig-cache.txt],")]),e._v(" "),t("br"),e._v(" "),t("code",[e._v("it looks like you have never mounted with this key")]),e._v(" "),t("br"),e._v(" "),t("code",[e._v("before. This could mean that you have typed your")]),e._v(" "),t("br"),e._v(" "),t("code",[e._v("passphrase wrong.")]),e._v(" "),t("br"),e._v(" "),t("code",[e._v("Would you like to proceed with the mount (yes/no)? :")]),e._v(" "),t("br")]),e._v(" "),t("li",[e._v("然后会提示，我们将 sig [181fb852cfe09961] 添加到 [/root/.ecryptfs/sig-cache.txt]  文件中,询问你是否为了避免将来出现这种警告，我选择了 yes "),t("br"),e._v(" "),t("code",[e._v("Would you like to append sig [181fb852cfe09961] to")]),e._v(" "),t("br"),e._v(" "),t("code",[e._v("[/root/.ecryptfs/sig-cache.txt]")]),e._v(" "),t("br"),e._v(" "),t("code",[e._v("in order to avoid this warning in the future (yes/no)? :")]),e._v(" "),t("br")]),e._v(" "),t("li",[e._v("然后就配置完成了，会提示你如下信 "),t("br"),e._v(" "),t("code",[e._v("Successfully appended new sig to user sig cache file")]),e._v(" "),t("br"),e._v(" "),t("code",[e._v("Mounted eCryptfs")]),e._v(" "),t("br")])])])]),e._v(" "),t("h2",{attrs:{id:"测试"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#测试"}},[e._v("#")]),e._v(" 测试")]),e._v(" "),t("p",[e._v("我们之前是将 "),t("code",[e._v("/root/Private")]),e._v(" 文件夹进行了 "),t("code",[e._v("ecryptfs")]),e._v(" 加密，所以我们现在在该目录下新建一个 test 测试文件，执行下面的命令:")]),e._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[e._v("vim")]),e._v(" /root/Private/test\n")])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br")])]),t("p",[e._v("打开之后随便输入一段话 ，我这里输入的是 "),t("code",[e._v("this is a test file")]),e._v(" ,然后利用命令 "),t("code",[e._v("cat /root/Private/test")]),e._v(" 来查看我们创建的测试文件，可以看出 "),t("code",[e._v("this is a test file")]),e._v(" ,正常的一段测试文字")]),e._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[e._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[e._v("umount")]),e._v(" -t ecryptfs /root/Private /root/Private\n")])]),e._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[e._v("1")]),t("br")])]),t("p",[e._v("执行命令之后，我们在使用命令来看之前创建好的测试文件 "),t("code",[e._v("cat /root/Private/test")]),e._v(" ,发现是一堆乱码 "),t("code",[e._v('F·+ZOk𤧍XF񉍝X嵰nyh֞fþdyF®/Ųµtaٓ[Iÿ݄ެº{;p}A4B񇈲K"򕵿ϋ-´qۋ쉔䳋~¿(§Y󗵶')]),e._v(" (这里只是给显示出一部分)，这样就取消了解密，看到的文件就是乱码，")])])}),[],!1,null,null,null);s.default=r.exports}}]);