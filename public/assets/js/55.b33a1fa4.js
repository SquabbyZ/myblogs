(window.webpackJsonp=window.webpackJsonp||[]).push([[55],{470:function(s,a,n){"use strict";n.r(a);var t=n(4),e=Object(t.a)({},(function(){var s=this,a=s.$createElement,n=s._self._c||a;return n("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[n("h2",{attrs:{id:"前提建议"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#前提建议"}},[s._v("#")]),s._v(" 前提建议")]),s._v(" "),n("p",[s._v("可以先简单的研究与实现下 "),n("code",[s._v("Nginx")]),s._v(" 的反向代理，实现出来效果后再仔细的看下该篇文章会有很大的帮助。")]),s._v(" "),n("h2",{attrs:{id:"负载均衡的介绍"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#负载均衡的介绍"}},[s._v("#")]),s._v(" 负载均衡的介绍")]),s._v(" "),n("p",[s._v("在介绍 Nginx 的负载均衡实现之前，先简单的说下负载均衡的分类，主要分为硬件负载均衡和软件负载均衡，硬件负载均衡是使用专门的软件和硬件相结合的设备，设备商会提供完整成熟的解决方案，比如 F5，在数据的稳定性以及安全性来说非常可靠，但是相比软件而言造价会更加昂贵；软件的负载均衡以 Nginx 这类软件为主，实现的一种消息队列分发机制。")]),s._v(" "),n("p",[s._v("简单来说所谓的负载均衡就是把很多请求进行分流，将他们分配到不同的服务器去处理。比如我有 3 个服务器，分别为 A、B、C，然后使用 Nginx 进行负载均衡，使用轮询策略，此时如果收到了 9 个请求，那么会均匀的将这 9 个请求分发给 A、B、C 服务器，每一个服务器处理 3 个请求，这样的话我们可以利用多台机器集群的特性减少单个服务器的压力。")]),s._v(" "),n("h2",{attrs:{id:"负载均衡策略"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#负载均衡策略"}},[s._v("#")]),s._v(" 负载均衡策略")]),s._v(" "),n("p",[n("code",[s._v("NGINX")]),s._v(" 开源支持四种负载平衡方法，而 NGINX Plus 又增加了两种方法")]),s._v(" "),n("ol",[n("li",[s._v("Round Robin: 对所有的请求进行轮询发送请求，默认的分配方式。")])]),s._v(" "),n("p",[s._v("nginx.conf 配置示例:")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("upstream zhuhaifeng "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n   server www.zhuhaifengz.club"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n   server www.zhuhaifeng.xyz"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br")])]),n("p",[n("strong",[s._v("注:上面的域名也可以用 IP 替代。")])]),s._v(" "),n("hr"),s._v(" "),n("p",[s._v("2.Least Connections：以最少的活动连接数将请求发送到服务器，同样要考虑服务器权重\nnginx.conf 配置示例:")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("\nupstream zhuhaifeng "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n   least_conn"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n   server www.zhuhaifengz.club"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n   server www.zhuhaifeng.xyz"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br")])]),n("hr"),s._v(" "),n("p",[s._v("3.IP Hash : 发送请求的服务器由客户机 IP 地址决定。在这种情况下，使用 IPv4 地址的前三个字节或整个 IPv6 地址来计算散列值。该方法保证来自相同地址的请求到达相同的服务器，除非该服务器不可用。")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("\nupstream zhuhaifeng "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n   ip_hash"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n   server www.zhuhaifengz.club"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n   server www.zhuhaifeng.xyz"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br")])]),n("hr"),s._v(" "),n("p",[s._v("4.Generic Hash: 请求发送到的服务器由用户定义的键决定，该键可以是文本字符串、变量或组合.")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("\nupstream zhuhaifeng "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n   "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("hash")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$request_uri")]),s._v(" consistent"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n   server www.zhuhaifengz.club"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n   server www.zhuhaifeng.xyz"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br")])]),n("hr"),s._v(" "),n("p",[s._v("5.Least Time (NGINX Plus only) – 对于每个请求，NGINX Plus 选择具有最低平均延迟和最低活动连接数的服务器，其中最低平均延迟是根据包含 least_time 指令的下列参数计算的:")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("header ：从服务器接收第一个字节的时间。\nlast_byte：从服务器接收完整响应的时间。\nlast_byte inflight：从服务器接收完整响应的时间。\n\nupstream zhuhaifeng "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n   least_time header"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n   server www.zhuhaifengz.club"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n   server www.zhuhaifeng.xyz"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br")])]),n("hr"),s._v(" "),n("p",[s._v("6.Random：每个请求将被传递到随机选择的服务器。如果指定了两个参数，首先，NGINX 根据服务器权重随机选择两个服务器，然后使用指定的方法选择其中一个。")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("least_conn ：活动连接的最少数量\n"),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("least_time")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("header "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("NGINX Plus"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("：从服务器接收响应标头的最短平均时间 "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$upstream_header_time")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("。\n"),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("least_time")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("last_byte "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("NGINX Plus"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" ：从服务器接收完整响应的最短平均时间（"),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$upstream_response_time")]),s._v("）。\n\n\nupstream zhuhaifeng "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n   random two "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("least_time")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("last_byte"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n   server www.zhuhaifengz.club"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n   server www.zhuhaifeng.xyz"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br")])]),n("h2",{attrs:{id:"具体项目实现效果与-nginx-配置请点击下方"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#具体项目实现效果与-nginx-配置请点击下方"}},[s._v("#")]),s._v(" 具体项目实现效果与 Nginx 配置请点击下方")]),s._v(" "),n("p",[n("RouterLink",{attrs:{to:"/views/nginx/2.html"}},[s._v("Nginx 反向代理试水")])],1)])}),[],!1,null,null,null);a.default=e.exports}}]);