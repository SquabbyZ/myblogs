(window.webpackJsonp=window.webpackJsonp||[]).push([[74],{551:function(t,e,v){"use strict";v.r(e);var _=v(3),c=Object(_.a)({},(function(){var t=this,e=t.$createElement,v=t._self._c||e;return v("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[v("h2",{attrs:{id:"准备工作"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#准备工作"}},[t._v("#")]),t._v(" 准备工作")]),t._v(" "),v("ol",[v("li",[v("a",{attrs:{href:""}},[t._v("Windows 系统上 局域网部署 Gitblit 教程")])]),t._v(" "),v("li",[v("a",{attrs:{href:""}},[t._v("Windows 系统上 局域网部署 Jenkins 教程")])]),t._v(" "),v("li",[v("a",{attrs:{href:""}},[t._v("修改 Jenkins 默认端口")])])]),t._v(" "),v("h2",{attrs:{id:"项目需求与选择的理由"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#项目需求与选择的理由"}},[t._v("#")]),t._v(" 项目需求与选择的理由")]),t._v(" "),v("div",{staticClass:"custom-block tip"},[v("p",{staticClass:"custom-block-title"},[t._v("阐述为什么使用 Jenkins + Gitblit")]),t._v(" "),v("ol",[v("li",[v("p",[t._v("整个项目的开发环境是纯局域网,也是我做前端以来最难的开发环境(没有之一),开发配置:")]),t._v(" "),v("ol",[v("li",[t._v("我用的 "),v("strong",[v("code",[t._v("Vuecli3.0")])]),t._v(" 搭建的项目,用 VueCli3.0 做基础模板,修改 "),v("code",[t._v("vue.config.js")]),t._v(" 来进行项目的修改配置;")]),t._v(" "),v("li",[t._v("用的 "),v("strong",[v("code",[t._v("express")])]),t._v(" 来静态的托管前端的项目;")]),t._v(" "),v("li",[t._v("因项目需求登录做的静态 JSON 文件的登录(之前使用的是 "),v("code",[t._v("axios-mock-adapter")]),t._v(" 和 "),v("code",[t._v("mockjs")]),t._v(" 来进行的本地 JSON 模拟登录,但是会屏蔽掉除了登录外的后端请求接口)")]),t._v(" "),v("li",[t._v("使用的是 "),v("strong",[v("code",[t._v("forever")])]),t._v(" 依赖包来进行的后台项目的启动;")]),t._v(" "),v("li",[t._v("之前公司使用的都是 "),v("code",[t._v("Svn")]),t._v(" 来进行项目的管理,对于我这种从入行开始就是在敲着 "),v("code",[t._v("Git")]),t._v(" 的小小白来说,还是喜欢 "),v("code",[t._v("Git")]),t._v(" 命令,因此选择了 "),v("code",[t._v("Gitblit")]),t._v(" (不选 "),v("code",[t._v("Gitlab")]),t._v(" 是因为没网 T.T)")])])]),t._v(" "),v("li",[v("p",[t._v("本着闲不住的性格(其实是为了省事,要不每次都要提交完代码后,手动 "),v("code",[t._v("yarn build")]),t._v(" ,再用 "),v("code",[t._v("xshell")]),t._v(" 输入命令 "),v("code",[t._v("forever stop app.js")]),t._v(" 停服务,用 "),v("code",[t._v("Xftp")]),t._v(" 把打包完的项目\n传入到远端服务器,再 "),v("code",[t._v("forever start app.js")]),t._v("),真的是太麻烦了,因此想到之前了解到 "),v("code",[t._v("Jenkins")]),t._v(" 这个自动化构建工具,配合之前的搭建好的 "),v("code",[t._v("Gitblit")]),t._v(" 项目管理工具,花了 1 天的时间,按照自己的\n项目需求完成了第一版的简单的配置搭建。")])])])]),t._v(" "),v("h2",{attrs:{id:"gitblit-配置部分"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#gitblit-配置部分"}},[t._v("#")]),t._v(" Gitblit 配置部分")]),t._v(" "),v("ol",[v("li",[v("p",[t._v("首先先找到 "),v("code",[t._v("gitblit-1.8.0")]),t._v(" 的服务跟目录,然后 进入到 "),v("code",[t._v("/data/groovy/")]),t._v(" 文件夹下 可以看到下图中标记的两个文件,在你刚进入到时候只有 "),v("code",[t._v("jenkins.groovy")]),t._v(" 这一个文件,因为有多个 "),v("code",[t._v("Gitblit")]),t._v(" 的项目,\n所以复制一份命名为 "),v("code",[t._v("jenkins_converge.groovy")]),t._v(" "),v("img",{attrs:{src:"http://lc-zltjehai.cn-n1.lcfile.com/177d9117fbe438b1cef1/jenkins6-0.png",alt:""}})])]),t._v(" "),v("li",[v("p",[t._v("然后打开 "),v("code",[t._v("jenkins_converge.groovy")]),t._v(" 文件,并且用鼠标滚动到最下面,如下图:")])])]),t._v(" "),v("p",[v("img",{attrs:{src:"http://lc-zltjehai.cn-n1.lcfile.com/dcbc919414a2821efd15/jenkins6-1.png",alt:""}})]),t._v(" "),v("ol",[v("li",[t._v("图中标白色的地方,填入你本机的 "),v("code",[t._v("Jenkins")]),t._v(" 项目(就是登陆的时候 "),v("code",[t._v("Jenkins")]),t._v(" 在浏览器地址栏里显示的 IP + 端口号),修改完后保存即可。")]),t._v(" "),v("li",[t._v("登录到你的 "),v("code",[t._v("Gitblit")]),t._v(" 项目中,然后点击左上方的 "),v("code",[t._v("编辑")]),t._v(" 按钮,如下图:(如果没有显示那个按钮,说明你不是项目的管理员,需要找管理员给你加权限)")])]),t._v(" "),v("p",[v("img",{attrs:{src:"http://lc-zltjehai.cn-n1.lcfile.com/8c4c71693fc8013b79e0/jenkins6-2.png",alt:""}})]),t._v(" "),v("ol",[v("li",[t._v("点击 左侧列表中的 "),v("code",[t._v("receive")])])]),t._v(" "),v("p",[v("img",{attrs:{src:"http://lc-zltjehai.cn-n1.lcfile.com/833ce29bda3d3b48cb4c/jenkins6-3.png",alt:""}})]),t._v(" "),v("p",[t._v("点开后如图:")]),t._v(" "),v("p",[v("img",{attrs:{src:"http://lc-zltjehai.cn-n1.lcfile.com/b0f22bb5d0b9469636c9/jenkins6-4.png",alt:""}})]),t._v(" "),v("ol",[v("li",[t._v("选择上图中最下面的 "),v("code",[t._v("post-receive 脚本")]),t._v(" 部分,在穿梭框的左侧列表中找到我们之前在 "),v("code",[t._v("/gitblit-1.8.0/data/groovy/")]),t._v(" 目录下新建的 "),v("code",[t._v("jenkins_converge.groovy")]),t._v(" ,双击之后,直接点击页面最下方的保存即可,如图:")])]),t._v(" "),v("p",[v("img",{attrs:{src:"http://lc-zltjehai.cn-n1.lcfile.com/5de9ac74df5958b9a5f3/jenkins6-5.png",alt:""}})]),t._v(" "),v("h2",{attrs:{id:"jenkins-配置部分"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#jenkins-配置部分"}},[t._v("#")]),t._v(" Jenkins 配置部分")]),t._v(" "),v("h3",{attrs:{id:"需要的插件"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#需要的插件"}},[t._v("#")]),t._v(" 需要的插件")]),t._v(" "),v("p",[v("strong",[t._v("安装 Jenkins 的时候在有网络的电脑上先安装,然后选择插件的时候选择 "),v("code",[t._v("新手推荐")])])]),t._v(" "),v("ol",[v("li",[t._v("GitBlit Plugin")]),t._v(" "),v("li",[t._v("NodeJS Plugin")]),t._v(" "),v("li",[t._v("Publish Over SSH")])]),t._v(" "),v("p",[v("strong",[t._v("这些插件才用默认的配置就能下载如果,出现 "),v("code",[t._v("Time out")]),t._v(" 的报错,可以更换"),v("a",{attrs:{href:""}},[t._v("国内镜像")]),t._v("即可")])]),t._v(" "),v("h3",{attrs:{id:"jenkins-全局配置"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#jenkins-全局配置"}},[t._v("#")]),t._v(" Jenkins 全局配置")]),t._v(" "),v("p",[v("strong",[t._v("因为我使用的是 Jenklins 2.203 我写这篇文章时候的最新版,因此汉化不是很完全")])]),t._v(" "),v("ol",[v("li",[t._v("进入到 Jenkins 的首页点击 "),v("code",[t._v("Manage Jenkins")]),t._v(" ,如图:")])]),t._v(" "),v("p",[v("img",{attrs:{src:"http://lc-zltjehai.cn-n1.lcfile.com/59c31af642a28103f87d/jenkins6-6.png",alt:""}})]),t._v(" "),v("ol",{attrs:{start:"2"}},[v("li",[t._v("然后再点击 "),v("code",[t._v("Global Tool Configuration")]),t._v(" :")])]),t._v(" "),v("p",[v("img",{attrs:{src:"http://lc-zltjehai.cn-n1.lcfile.com/6a5c49ae2bf0bfadab3f/jenkins6-7.png",alt:""}})]),t._v(" "),v("ol",[v("li",[t._v("因为在这之前,我使用的是 "),v("code",[t._v("Git for Window")]),t._v(" 的命令工具 "),v("code",[t._v("Git bash")]),t._v(" ,所以我这里的 Git 配置是默认的:")])]),t._v(" "),v("p",[v("img",{attrs:{src:"http://lc-zltjehai.cn-n1.lcfile.com/23af686e471b88171f6e/jenkins6-8.png",alt:""}})]),t._v(" "),v("ol",{attrs:{start:"2"}},[v("li",[v("code",[t._v("Node.js")]),t._v(" 的配置,我本地使用的是 "),v("code",[t._v("node-10.5.0")]),t._v(" 的版本,因此别名我使用的是 "),v("code",[t._v("NodeJS_10.5.0")]),t._v(" ,配置如图:")])]),t._v(" "),v("p",[v("img",{attrs:{src:"http://lc-zltjehai.cn-n1.lcfile.com/425835e9365dedd87ffc/jenkins6-9.png",alt:""}})]),t._v(" "),v("ol",{attrs:{start:"3"}},[v("li",[t._v("点击保存后,页面会自动的回到点击 "),v("code",[t._v("Manage Jenkins")]),t._v(" 后的管理页面,再点击 "),v("code",[t._v("Configure System")]),t._v(" ,如下图:")])]),t._v(" "),v("p",[v("img",{attrs:{src:"http://lc-zltjehai.cn-n1.lcfile.com/6c38574384ff5d015df9/jenkins6-10.png",alt:""}})]),t._v(" "),v("ol",[v("li",[t._v("往下滑动页面,找到 "),v("code",[t._v("Gitblit Severs")]),t._v(" 进行配置,只要在 "),v("code",[t._v("API endpoint")]),t._v(" 处,填入你的 "),v("code",[t._v("Gitblit")]),t._v(" 的服务地址即可,这里我使用的是 8443 ,"),v("code",[t._v("Gitblit")]),t._v(" 服务的默认端口.")])]),t._v(" "),v("p",[v("img",{attrs:{src:"http://lc-zltjehai.cn-n1.lcfile.com/2f4cc4fbbd36b688c9a2/jenkins6-11.png",alt:""}})]),t._v(" "),v("ol",{attrs:{start:"2"}},[v("li",[t._v("因为还需要向远程的服务器传送打包后的文件,所以在这个页面的 "),v("code",[t._v("Publish over SSH")]),t._v(" 配置数据,如下图:\n"),v("img",{attrs:{src:"http://lc-zltjehai.cn-n1.lcfile.com/46866f5e01b35c94b403/jenkins6-12.png",alt:""}})])]),t._v(" "),v("hr"),t._v(" "),v("p",[t._v("Passphrase: 远程连接登录的用户的密码;")]),t._v(" "),v("p",[t._v("Name: 自定义启的连接名;\nHostname: 远程服务器的 IP;\nUsername: 登录远程服务器的用户名;\nRemote Directory: 远程全目录(可以理解为你要把项目代码部署的路径)")]),t._v(" "),v("p",[t._v("Test Configuration: 测试所填的 "),v("code",[t._v("SSH Server")]),t._v(" 是否能连通,连通的话点击后会如下图显示:")]),t._v(" "),v("hr"),t._v(" "),v("p",[v("img",{attrs:{src:"http://lc-zltjehai.cn-n1.lcfile.com/c78a7a5a1b9b4e9ab630/jenkins6-13.png",alt:""}})]),t._v(" "),v("ol",{attrs:{start:"3"}},[v("li",[t._v("点击保存,到这里全局的配置都设置完成.")])]),t._v(" "),v("h2",{attrs:{id:"新建项目"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#新建项目"}},[t._v("#")]),t._v(" 新建项目")]),t._v(" "),v("p",[t._v("返回到 "),v("code",[t._v("Jenkins")]),t._v(" 的最初的界面,点击 "),v("code",[t._v("新建Item")]),t._v(" ,会跳转到如下的界面")]),t._v(" "),v("p",[v("img",{attrs:{src:"http://lc-zltjehai.cn-n1.lcfile.com/ad0419a0ed2dea1793b6/jenkins6-14.png",alt:""}})]),t._v(" "),v("p",[t._v("在上图的 "),v("code",[t._v("输入一个任务名称")]),t._v(" 下面的红框内输入你的流水线的名称,我建议一般跟你 "),v("code",[t._v("Gitblit")]),t._v(" 上的对应的项目名称一样,以便方便区分。")]),t._v(" "),v("p",[t._v("第二个红框 "),v("code",[t._v("Freestyle project")]),t._v(" 是自定义风格项目,说白了就是空模板,你可以任意配置.填完名字选完 "),v("code",[t._v("Freestyle project")]),t._v(" ,点击左下角的确定页面就会跳转到如下图:")]),t._v(" "),v("p",[v("img",{attrs:{src:"http://lc-zltjehai.cn-n1.lcfile.com/034bd68fe29b189b5320/jenkins6-15.png",alt:""}})]),t._v(" "),v("h2",{attrs:{id:"项目配置"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#项目配置"}},[t._v("#")]),t._v(" 项目配置")]),t._v(" "),v("h3",{attrs:{id:"general"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#general"}},[t._v("#")]),t._v(" General")]),t._v(" "),v("div",{staticClass:"language- extra-class"},[v("pre",[v("code",[t._v("这里可以根据自己项目的需求进行一些配置,因为我这个是局域网开发,因此我只在描述中继续下项目的大致描述。\n")])])]),v("p",[v("img",{attrs:{src:"http://lc-zltjehai.cn-n1.lcfile.com/a883b10e8d30f56fd943/jenkins6-16.png",alt:""}})]),t._v(" "),v("h3",{attrs:{id:"源码管理"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#源码管理"}},[t._v("#")]),t._v(" 源码管理")]),t._v(" "),v("p",[v("img",{attrs:{src:"http://lc-zltjehai.cn-n1.lcfile.com/ee633c2e6570fd5ae8df/jenkins6-17.png",alt:""}})]),t._v(" "),v("p",[t._v("默认的值是 "),v("code",[t._v("无")]),t._v(",可选的值有 "),v("code",[t._v("Git")]),t._v(" 和 "),v("code",[t._v("Subversion")]),t._v(",因为我们做的是 "),v("code",[t._v("Gitblit")]),t._v(" 的联动,因此我们这里选择 "),v("code",[t._v("Git")]),t._v(",页面会变成如下图")]),t._v(" "),v("p",[v("img",{attrs:{src:"http://lc-zltjehai.cn-n1.lcfile.com/a48051e00fa599251f4b/jenkins6-18.png",alt:""}})]),t._v(" "),v("hr"),t._v(" "),v("p",[t._v("Branches to build : "),v("code",[t._v("指定分支( 为空时代表 any )")]),t._v(": 你所要构建的分支(因为整个项目就是我自己在开发,没没有分配分支,因此我这里是默认的 "),v("code",[t._v("master")]),t._v(" 分支)")]),t._v(" "),v("p",[t._v("Repository URL: 在 "),v("code",[t._v("Gitblit")]),t._v(" 上的项目地址;\nCredentials: 用户名和密码,默认是无,可以选择后面的"),v("code",[t._v("添加")]),t._v(" 按钮进行添加,如下图:")]),t._v(" "),v("p",[v("img",{attrs:{src:"http://lc-zltjehai.cn-n1.lcfile.com/43c33eff0f3f6788f8b6/jenkins6-19.png",alt:""}})]),t._v(" "),v("p",[v("code",[t._v("用户名")]),t._v(": "),v("code",[t._v("Gitblit")]),t._v(" 远程的项目的管理的用户名\n"),v("code",[t._v("密码")]),t._v(": "),v("code",[t._v("Gitblit")]),t._v(" 远程的项目的管理的密码")]),t._v(" "),v("hr"),t._v(" "),v("h3",{attrs:{id:"构建触发器"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#构建触发器"}},[t._v("#")]),t._v(" 构建触发器")]),t._v(" "),v("p",[v("code",[t._v("构建触发器")]),t._v(",这里直选选择 "),v("code",[t._v("Poll SCM")]),t._v(" 就可以,如下图:\n"),v("img",{attrs:{src:"http://lc-zltjehai.cn-n1.lcfile.com/67c4c5f19a5e1667019b/jenkins6-20.png",alt:""}})]),t._v(" "),v("p",[t._v("选择完 "),v("code",[t._v("Poll SCM")]),t._v(" 会弹出个对话框,不用理会,默认就好.")]),t._v(" "),v("h3",{attrs:{id:"构建环境"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#构建环境"}},[t._v("#")]),t._v(" 构建环境")]),t._v(" "),v("p",[t._v("这里是配置构建时候需要的环境,如下图:")]),t._v(" "),v("p",[v("img",{attrs:{src:"http://lc-zltjehai.cn-n1.lcfile.com/218ae48c3d33d206551c/jenkins6-21.png",alt:""}})]),t._v(" "),v("p",[t._v("勾选中上图中红框标注的地方:")]),t._v(" "),v("hr"),t._v(" "),v("ol",[v("li",[v("code",[t._v("Send files or execute commands over SSH before the build starts")]),t._v(" (构建前向远程服务传送文件或者操作一些指令):\n会弹出如下图的页面:")])]),t._v(" "),v("p",[v("img",{attrs:{src:"http://lc-zltjehai.cn-n1.lcfile.com/28a479812a78eb35d888/jenkins6-22.png",alt:""}})]),t._v(" "),v("p",[t._v("Name: 就是之前在全局配置的时候 "),v("code",[t._v("Manage Jenkins")]),t._v(" --\x3e "),v("code",[t._v("Configure System")]),t._v(" --\x3e "),v("code",[t._v("Publish over SSH")]),t._v(" --\x3e "),v("code",[t._v("SSH Server")]),t._v(" 设置的那个 "),v("code",[t._v("Name")])]),t._v(" "),v("p",[t._v("Source files: 要上传到远程服务器的文件包含有文件夹(要是文件夹要名字后面 + "),v("code",[t._v("/**")]),t._v(" ，比如要上传 "),v("code",[t._v("static")]),t._v(" 文件夹,就要写 "),v("code",[t._v("static/**")]),t._v(");\nRemove prefix: 去除 "),v("code",[t._v("Source files")]),t._v(" 前面的前缀;\nRemote directory: 远程路径;\nExec command: 要在远程服务器上执行的命令,多行命令可以用 "),v("code",[t._v("Enter")]),t._v(" 回车符进行分隔开.")]),t._v(" "),v("hr"),t._v(" "),v("ol",{attrs:{start:"2"}},[v("li",[v("code",[t._v("Add timestamps to the Console Output")]),t._v(":在控制台输出的信息上添加时间点,可以方便观看每部操作消耗的时间.")])]),t._v(" "),v("hr"),t._v(" "),v("ol",{attrs:{start:"3"}},[v("li",[v("code",[t._v("Provide Node & npm bin/ folder to PATH")]),t._v(": 向指定的节点或者目录提供 node 服务,因为我们要在构建的过程中,自动打包。Vue 项目的打包还是要依赖于 Node\n服务的所以这里勾选,因为我们在前面配置了 "),v("code",[t._v("Jenkins")]),t._v(" 全局的 node 服务,所以这里勾选完,默认就之前配置的内容.")])]),t._v(" "),v("p",[v("img",{attrs:{src:"http://lc-zltjehai.cn-n1.lcfile.com/5e014c31002eef411935/jenkins6-23.png",alt:""}})]),t._v(" "),v("h3",{attrs:{id:"构建"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#构建"}},[t._v("#")]),t._v(" 构建")]),t._v(" "),v("p",[t._v("因为我要在构建的时候让 "),v("code",[t._v("Jenkins")]),t._v(" 去帮我生成打包文件,所以这里我选择了 "),v("code",[t._v("Window powershell")]),t._v(" 执行的命令是 "),v("code",[t._v("yarn build")]),t._v(" (我用的是 yarn 服务, 也可以写 "),v("code",[t._v("npm run build")]),t._v(")\n要添加多步指令,我建议点 "),v("code",[t._v("增加构建步骤")]),t._v(" 不要写在一个步骤里")]),t._v(" "),v("h3",{attrs:{id:"构建后操作"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#构建后操作"}},[t._v("#")]),t._v(" 构建后操作")]),t._v(" "),v("p",[t._v("因为我们要把打包后的文件推送到远程服务器上,因此 "),v("code",[t._v("构建后操作")]),t._v(" 这个步骤里选择 "),v("code",[t._v("Send build artifacts over SSH")]),t._v(" ,将打包后的文件推送到远程服务端,并且进入到目录下启动服务,如图:")]),t._v(" "),v("p",[v("img",{attrs:{src:"http://lc-zltjehai.cn-n1.lcfile.com/b23f93a91d0b8940340c/jenkins6-24.png",alt:""}})]),t._v(" "),v("h3",{attrs:{id:"点击保存完成"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#点击保存完成"}},[t._v("#")]),t._v(" 点击保存完成")]),t._v(" "),v("h2",{attrs:{id:"测试"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#测试"}},[t._v("#")]),t._v(" 测试")]),t._v(" "),v("p",[t._v("在项目随便修改些内容,然后提交上去,当你 "),v("code",[t._v("git push")]),t._v(" 完,项目自动开始跑构建就证明,配置成功。")]),t._v(" "),v("p",[v("strong",[t._v("欢迎留言评论 😃")])])])}),[],!1,null,null,null);e.default=c.exports}}]);